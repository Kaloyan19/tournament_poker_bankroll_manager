{% extends 'tournaments/base.html' %}

{% block title %}Dashboard{% endblock %}
{% block page_title %}Poker Dashboard{% endblock %}

{% block page_subtitle %}
<div class="d-flex justify-content-between align-items-center">
    <p class="text-muted mb-0">Track your poker performance and bankroll</p>
    <div class="btn-group">
        <a href="?period=week" class="btn btn-sm btn-outline-secondary {% if current_period == 'week' %}active{% endif %}">Week</a>
        <a href="?period=month" class="btn btn-sm btn-outline-secondary {% if current_period == 'month' %}active{% endif %}">Month</a>
        <a href="?period=year" class="btn btn-sm btn-outline-secondary {% if current_period == 'year' %}active{% endif %}">Year</a>
        <a href="?period=all" class="btn btn-sm btn-outline-secondary {% if current_period == 'all' %}active{% endif %}">All Time</a>
    </div>
</div>
{% endblock %}

{% block content %}
<div class="alert alert-info mb-4">
    <i class="bi bi-calendar-range me-2"></i>
    Showing statistics for: <strong>{{ period_display }}</strong>
</div>

<div class="row mb-4">
    <div class="col-md-4">
        <div class="card bankroll-card border-primary">
            <div class="card-body text-center">
                <h5 class="card-title text-muted">Current Bankroll</h5>
                <h1 class="card-text poker-green">{{ user.display_bankroll }}</h1>
                <p class="text-muted small">Available to play</p>
            </div>
        </div>
    </div>

    <div class="col-md-8">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Quick Actions</h5>
                <div class="d-grid gap-2 d-md-flex">
                    <a href="{% url 'tournaments:add_tournament' %}" class="btn btn-primary">
                        <i class="bi bi-plus-circle me-2"></i>Add Tournament
                    </a>
                    <a href="{% url 'tournaments:add_adjustment' %}" class="btn btn-outline-primary">
                        <i class="bi bi-arrow-left-right me-2"></i>Deposit/Withdraw
                    </a>
                    <a href="{% url 'tournaments:tournament_list' %}" class="btn btn-outline-secondary">
                        <i class="bi bi-list-ul me-2"></i>View All Tournaments
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mb-4">
    <div class="col-md-3 mb-3">
        <div class="card stat-card h-100">
            <div class="card-body">
                <h6 class="card-subtitle text-muted">Tournaments Played</h6>
                <h2 class="card-title">{{ total_tournaments }}</h2>
                <p class="card-text small">Avg Buy-in: ${{ avg_buy_in }}</p>
            </div>
        </div>
    </div>

    <div class="col-md-3 mb-3">
        <div class="card stat-card h-100">
            <div class="card-body">
                <h6 class="card-subtitle text-muted">Total Profit/Loss</h6>
                <h2 class="card-title {% if total_profit >= 0 %}profit-positive{% else %}profit-negative{% endif %}">
                    ${{ total_profit }}
                </h2>
                <p class="card-text small">ROI: {{ roi }}%</p>
            </div>
        </div>
    </div>

    <div class="col-md-3 mb-3">
        <div class="card stat-card h-100">
            <div class="card-body">
                <h6 class="card-subtitle text-muted">ITM Rate</h6>
                <h2 class="card-title">{{ itm_percentage }}%</h2>
                <p class="card-text small">{{ itm_count }} of {{ total_tournaments }} tournaments</p>
            </div>
        </div>
    </div>

    <div class="col-md-3 mb-3">
        <div class="card stat-card h-100">
            <div class="card-body">
                <h6 class="card-subtitle text-muted">Top Finishes</h6>
                <h2 class="card-title">{{ first_places }} wins</h2>
                <p class="card-text small">{{ top_10_finishes }} top 10 finishes</p>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-8 mb-4">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Recent Tournaments</h5>
                <a href="{% url 'tournaments:tournament_list' %}" class="btn btn-sm btn-outline-primary">View All</a>
            </div>
            <div class="card-body p-0">
                {% if tournaments %}
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>Date</th>
                                <th>Buy-in</th>
                                <th>Cashed</th>
                                <th>Place</th>
                                <th>Net</th>
                                <th>ITM</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for tournament in tournaments %}
                            <tr>
                                <td>{{ tournament.date }}</td>
                                <td>${{ tournament.buy_in }}</td>
                                <td>${{ tournament.cashed_for }}</td>
                                <td>{{ tournament.place_finished }}</td>
                                <td class="{% if tournament.net_amount >= 0 %}profit-positive{% else %}profit-negative{% endif %}">
                                    {{ tournament.display_net }}
                                </td>
                                <td>
                                    {% if tournament.is_itm %}
                                    <span class="badge bg-success">Yes</span>
                                    {% else %}
                                    <span class="badge bg-secondary">No</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-5">
                    <i class="bi bi-trophy display-1 text-muted"></i>
                    <p class="mt-3">No tournaments yet. Add your first tournament!</p>
                    <a href="{% url 'tournaments:add_tournament' %}" class="btn btn-primary">Add Tournament</a>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="col-md-4 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Recent Bankroll Adjustments</h5>
            </div>
            <div class="card-body">
                {% if adjustments %}
                <div class="list-group list-group-flush">
                    {% for adjustment in adjustments %}
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                            <small class="text-muted">{{ adjustment.date|date:"M d" }}</small>
                            <div class="fw-bold">
                                {% if adjustment.transaction_type == 'deposit' %}
                                <i class="bi bi-arrow-down-circle text-success me-1"></i>
                                {% elif adjustment.transaction_type == 'withdrawal' %}
                                <i class="bi bi-arrow-up-circle text-warning me-1"></i>
                                {% else %}
                                <i class="bi bi-arrow-left-right text-info me-1"></i>
                                {% endif %}
                                ${{ adjustment.amount }}
                            </div>
                            <small class="text-muted">{{ adjustment.get_transaction_type_display }}</small>
                        </div>
                        <span class="badge bg-{% if adjustment.transaction_type == 'deposit' %}success{% elif adjustment.transaction_type == 'withdrawal' %}warning{% else %}info{% endif %}">
                            {{ adjustment.get_transaction_type_display }}
                        </span>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-center py-4">
                    <i class="bi bi-cash-stack display-1 text-muted"></i>
                    <p class="mt-3">No adjustments yet</p>
                </div>
                {% endif %}
                <div class="mt-3">
                    <a href="{% url 'tournaments:add_adjustment' %}" class="btn btn-outline-primary w-100">
                        <i class="bi bi-plus-circle me-2"></i>New Adjustment
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="card mt-4">
    <div class="card-header">
        <h5 class="mb-0">Period Summary</h5>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-4">
                <p class="mb-1">Total Buy-ins: <strong>${{ total_buy_ins }}</strong></p>
                <p class="mb-1">Total Cash: <strong>${{ total_cash }}</strong></p>
            </div>
            <div class="col-md-4">
                <p class="mb-1">Deposits: <strong class="text-success">${{ total_deposits }}</strong></p>
                <p class="mb-1">Withdrawals: <strong class="text-warning">${{ total_withdrawals }}</strong></p>
            </div>
            <div class="col-md-4">
                <p class="mb-1">1st Place: <strong>{{ first_place_percentage }}%</strong></p>
                <p class="mb-1">Top 10: <strong>{{ top_10_percentage }}%</strong></p>
            </div>
        </div>
    </div>
</div>
{% endblock %}